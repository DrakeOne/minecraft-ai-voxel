<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Minecraft Ultra - Optimized Voxel Engine</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            overflow: hidden;
            font-family: 'Courier New', monospace;
            background: #87CEEB;
            cursor: crosshair;
        }
        
        canvas {
            display: block;
            width: 100vw;
            height: 100vh;
        }
        
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #87CEEB, #98D8C8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s;
        }
        
        #loading h1 {
            color: white;
            font-size: 48px;
            margin-bottom: 20px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
        }
        
        .loading-bar {
            width: 300px;
            height: 20px;
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .loading-progress {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            width: 0%;
            transition: width 0.3s;
            animation: loading 1s ease-in-out;
        }
        
        @keyframes loading {
            0% { width: 0%; }
            100% { width: 100%; }
        }
        
        #ui {
            pointer-events: none;
            user-select: none;
        }
        
        #stats {
            background: rgba(0,0,0,0.5);
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
            line-height: 1.5;
        }
        
        #crosshair {
            font-weight: bold;
            pointer-events: none;
        }
        
        #controls {
            background: rgba(0,0,0,0.3);
            padding: 8px;
            border-radius: 5px;
        }
        
        #flying {
            font-weight: bold;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Mobile controls */
        @media (max-width: 768px) {
            #controls {
                display: none;
            }
            
            .mobile-controls {
                position: fixed;
                bottom: 20px;
                left: 20px;
                display: flex;
                gap: 10px;
                pointer-events: auto;
            }
            
            .mobile-btn {
                width: 60px;
                height: 60px;
                background: rgba(255,255,255,0.3);
                border: 2px solid white;
                border-radius: 50%;
                color: white;
                font-size: 24px;
                display: flex;
                align-items: center;
                justify-content: center;
                touch-action: none;
            }
            
            .joystick {
                position: fixed;
                bottom: 20px;
                right: 20px;
                width: 120px;
                height: 120px;
                background: rgba(255,255,255,0.2);
                border: 2px solid white;
                border-radius: 50%;
                pointer-events: auto;
            }
            
            .joystick-knob {
                position: absolute;
                width: 40px;
                height: 40px;
                background: white;
                border-radius: 50%;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                pointer-events: none;
            }
        }
        
        /* Performance mode indicator */
        .perf-mode {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            background: rgba(0,0,0,0.5);
            color: white;
            border-radius: 3px;
            font-size: 12px;
        }
        
        .perf-high { color: #4CAF50; }
        .perf-medium { color: #FFC107; }
        .perf-low { color: #F44336; }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading">
        <h1>⛏️ Minecraft Ultra</h1>
        <div class="loading-bar">
            <div class="loading-progress"></div>
        </div>
        <p style="color: white; margin-top: 20px;">Generating world...</p>
    </div>
    
    <!-- Performance Mode Indicator -->
    <div class="perf-mode" id="perfMode">
        Performance: <span id="perfLevel" class="perf-high">HIGH</span>
    </div>
    
    <!-- Three.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- Game Script -->
    <script src="game.js"></script>
    
    <!-- Loading Handler -->
    <script>
        // Hide loading screen after game initializes
        window.addEventListener('load', () => {
            setTimeout(() => {
                const loading = document.getElementById('loading');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                }, 500);
            }, 1000);
        });
        
        // Performance monitoring
        let frameCount = 0;
        let lastCheck = performance.now();
        
        function checkPerformance() {
            requestAnimationFrame(checkPerformance);
            frameCount++;
            
            const now = performance.now();
            if (now - lastCheck >= 1000) {
                const fps = frameCount;
                frameCount = 0;
                lastCheck = now;
                
                const perfLevel = document.getElementById('perfLevel');
                if (fps >= 50) {
                    perfLevel.textContent = 'HIGH';
                    perfLevel.className = 'perf-high';
                } else if (fps >= 30) {
                    perfLevel.textContent = 'MEDIUM';
                    perfLevel.className = 'perf-medium';
                } else {
                    perfLevel.textContent = 'LOW';
                    perfLevel.className = 'perf-low';
                }
            }
        }
        
        checkPerformance();
        
        // Mobile detection and controls
        if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
            document.body.innerHTML += `
                <div class="mobile-controls">
                    <button class="mobile-btn" ontouchstart="mobileJump()">↑</button>
                    <button class="mobile-btn" ontouchstart="toggleFly()">✈️</button>
                </div>
                <div class="joystick" id="joystick">
                    <div class="joystick-knob" id="joystick-knob"></div>
                </div>
            `;
            
            // Joystick controls
            const joystick = document.getElementById('joystick');
            const knob = document.getElementById('joystick-knob');
            let joystickActive = false;
            
            joystick.addEventListener('touchstart', (e) => {
                joystickActive = true;
                handleJoystick(e.touches[0]);
            });
            
            joystick.addEventListener('touchmove', (e) => {
                if (joystickActive) {
                    handleJoystick(e.touches[0]);
                }
            });
            
            joystick.addEventListener('touchend', () => {
                joystickActive = false;
                knob.style.transform = 'translate(-50%, -50%)';
                // Reset movement
                if (window.mobileMovement) {
                    window.mobileMovement.x = 0;
                    window.mobileMovement.z = 0;
                }
            });
            
            function handleJoystick(touch) {
                const rect = joystick.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                
                let deltaX = touch.clientX - centerX;
                let deltaY = touch.clientY - centerY;
                
                const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                const maxDistance = rect.width / 2 - 20;
                
                if (distance > maxDistance) {
                    deltaX = (deltaX / distance) * maxDistance;
                    deltaY = (deltaY / distance) * maxDistance;
                }
                
                knob.style.transform = `translate(calc(-50% + ${deltaX}px), calc(-50% + ${deltaY}px))`;
                
                // Set movement vector
                if (!window.mobileMovement) {
                    window.mobileMovement = { x: 0, z: 0 };
                }
                window.mobileMovement.x = deltaX / maxDistance;
                window.mobileMovement.z = deltaY / maxDistance;
            }
        }
        
        function mobileJump() {
            if (window.mobileControls) {
                window.mobileControls.jump = true;
                setTimeout(() => {
                    window.mobileControls.jump = false;
                }, 100);
            }
        }
        
        function toggleFly() {
            if (window.mobileControls) {
                window.mobileControls.fly = !window.mobileControls.fly;
            }
        }
        
        // Initialize mobile controls object
        window.mobileControls = {
            jump: false,
            fly: false
        };
        
        // Prevent scrolling on mobile
        document.addEventListener('touchmove', (e) => {
            e.preventDefault();
        }, { passive: false });
        
        // Fullscreen on mobile
        document.addEventListener('touchstart', () => {
            if (document.documentElement.requestFullscreen && !document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(() => {});
            }
        }, { once: true });
    </script>
</body>
</html>